# Filmorate Database Schema

## Описание структуры базы данных

### Основные сущности

#### 1. Пользователи (`users`)

| Поле       | Тип         | Ограничения                          | Описание                |
|------------|-------------|--------------------------------------|-------------------------|
| user_id    | INT         | GENERATED BY DEFAULT AS IDENTITY PK  | Уникальный идентификатор|
| email      | VARCHAR(50) | NOT NULL, UNIQUE                     | Электронная почта       |
| login      | VARCHAR(50) | NOT NULL                             | Логин пользователя      |
| name       | VARCHAR(50) |                                      | Имя пользователя        |
| birthday   | DATE        |                                      | Дата рождения           |

#### 2. Фильмы (`films`)

| Поле          | Тип          | Ограничения                          | Описание               |
|---------------|--------------|--------------------------------------|------------------------|
| film_id       | INT          | GENERATED BY DEFAULT AS IDENTITY PK  | Уникальный идентификатор|
| name          | VARCHAR(100) | NOT NULL                             | Название фильма        |
| description   | VARCHAR(200) |                                      | Описание фильма        |
| release_date  | DATE         | NOT NULL                             | Дата выхода            |
| duration      | INT          | NOT NULL, CHECK (duration > 0)       | Продолжительность(мин) |
| mpa_rating_id | INT          | REFERENCES mpa_rating(mpa_id)        | Возрастной рейтинг     |

### Справочные таблицы

#### 3. Жанры (`genre`)

| Поле       | Тип         | Ограничения               | Описание         |
|------------|-------------|---------------------------|------------------|
| genre_id   | INT         | PRIMARY KEY               | ID жанра         |
| name       | VARCHAR(50) | NOT NULL, UNIQUE          | Название жанра   |

#### 4. Возрастные рейтинги (`mpa_rating`)

| Поле         | Тип         | Ограничения               | Описание               |
|--------------|-------------|---------------------------|------------------------|
| mpa_id       | INT         | PRIMARY KEY               | ID рейтинга            |
| mpa_name     | VARCHAR(10) | NOT NULL, UNIQUE          | Код рейтинга (G, PG-13)|
| description  | VARCHAR(200)|                           | Описание рейтинга      |

#### 5. Режиссеры (`directors`)

| Поле        | Тип          | Ограничения                          | Описание          |
|-------------|--------------|--------------------------------------|-------------------|
| id | INT          | GENERATED BY DEFAULT AS IDENTITY PK  | ID режиссера      |
| name        | VARCHAR(100) | NOT NULL                             | Имя режиссера     |

### Таблицы связей

#### 6. Дружба (`friendship`)

| Поле         | Тип         | Ограничения                              | Описание                |
|--------------|-------------|------------------------------------------|-------------------------|
| user_id      | INT         | PK, FK (users.user_id) ON DELETE CASCADE | ID пользователя         |
| friend_id    | INT         | PK, FK (users.user_id) ON DELETE CASCADE | ID друга                |
| status       | VARCHAR(20) | DEFAULT 'PENDING', CHECK IN ('PENDING','CONFIRMED') | Статус дружбы |
| created_date | TIMESTAMP   | DEFAULT CURRENT_TIMESTAMP                | Дата создания связи     |

#### 7. Связь фильмов и жанров (`film_genre`)

| Поле     | Тип  | Ограничения                              | Описание         |
|----------|------|------------------------------------------|------------------|
| film_id  | INT  | PK, FK (films.film_id) ON DELETE CASCADE | ID фильма        |
| genre_id | INT  | PK, FK (genre.genre_id) ON DELETE CASCADE| ID жанра         |

#### 8. Лайки фильмов (`film_likes`)

| Поле     | Тип  | Ограничения                              | Описание         |
|----------|------|------------------------------------------|------------------|
| film_id  | INT  | PK, FK (films.film_id) ON DELETE CASCADE | ID фильма        |
| user_id  | INT  | PK, FK (users.user_id) ON DELETE CASCADE | ID пользователя  |

#### 9. Связь фильмов и режиссеров (`film_directors`)

| Поле        | Тип  | Ограничения                              | Описание         |
|-------------|------|------------------------------------------|------------------|
| film_id     | INT  | PK, FK (films.film_id) ON DELETE CASCADE | ID фильма        |
| id | INT  | PK, FK (directors.id) ON DELETE CASCADE | ID режиссера |

### Функциональные таблицы

#### 10. Отзывы (`reviews`)

| Поле        | Тип     | Ограничения                              | Описание                     |
|-------------|---------|------------------------------------------|------------------------------|
| review_id   | INT     | GENERATED BY DEFAULT AS IDENTITY PK      | ID отзыва                    |
| content     | TEXT    | NOT NULL                                 | Текст отзыва                 |
| is_positive | BOOLEAN | NOT NULL                                 | Тип отзыва(true=положительный) |
| user_id     | INT     | FK (users.user_id) ON DELETE CASCADE     | ID автора                    |
| film_id     | INT     | FK (films.film_id) ON DELETE CASCADE     | ID фильма                    |
| useful      | INT     | DEFAULT 0                                | Рейтинг полезности           |

#### 11. Оценки отзывов (`review_likes`)

| Поле      | Тип     | Ограничения                              | Описание                     |
|-----------|---------|------------------------------------------|------------------------------|
| review_id | INT     | PK, FK (reviews.review_id) ON DELETE CASCADE | ID отзыва                |
| user_id   | INT     | PK, FK (users.user_id) ON DELETE CASCADE | ID пользователя           |
| is_like   | BOOLEAN | NOT NULL                                 | Оценка (true=полезно)      |

#### 12. Лента событий (`feed`)

| Поле       | Тип         | Ограничения                              | Описание                     |
|------------|-------------|------------------------------------------|------------------------------|
| event_id   | INT         | GENERATED BY DEFAULT AS IDENTITY PK      | ID события                   |
| user_id    | INT         | FK (users.user_id) ON DELETE CASCADE     | ID пользователя              |
| event_type | VARCHAR(10) | NOT NULL, CHECK IN ('LIKE','REVIEW','FRIEND') | Тип события         |
| operation  | VARCHAR(10) | NOT NULL, CHECK IN ('ADD','REMOVE','UPDATE') | Операция           |
| entity_id  | INT         | NOT NULL                                 | ID связанной сущности        |
| timestamp  | TIMESTAMP   | DEFAULT CURRENT_TIMESTAMP                | Время события                |

## ER-диаграмма базы данных Filmorate

```mermaid
erDiagram
    users {
        int user_id
        string email
        string login
        string name
        date birthday
    }
    
    films {
        int film_id
        string name
        string description
        date release_date
        int duration
        int mpa_rating_id
    }
    
    genre {
        int genre_id
        string name
    }
    
    mpa_rating {
        int mpa_id
        string mpa_name
        string description
    }
    
    directors {
        int id
        string name
    }
    
    friendship {
        int user_id
        int friend_id
        string status
        timestamp created_date
    }
    
    film_genre {
        int film_id
        int genre_id
    }
    
    film_likes {
        int film_id
        int user_id
    }
    
    film_directors {
        int film_id
        int id
    }
    
    reviews {
        int review_id
        text content
        boolean is_positive
        int user_id
        int film_id
        int useful
    }
    
    review_likes {
        int review_id
        int user_id
        boolean is_like
    }
    
    feed {
        int event_id
        int user_id
        string event_type
        string operation
        int entity_id
        timestamp timestamp
    }

    users ||--o{ friendship : "имеет друзей"
    users ||--o{ film_likes : "ставит лайки"
    users ||--o{ reviews : "пишет отзывы"
    users ||--o{ review_likes : "оценивает отзывы"
    users ||--o{ feed : "имеет события"
    films ||--o{ film_genre : "имеет жанры"
    films ||--o{ film_likes : "получает лайки"
    films ||--o{ film_directors : "имеет режиссеров"
    films ||--o{ reviews : "имеет отзывы"
    films }|--|| mpa_rating : "имеет рейтинг"
    film_genre }|--|| genre : "относится к"
    film_directors }|--|| directors : "связан с"
    reviews }|--|| users : "автор"
    reviews }|--|| films : "о фильме"
    review_likes }|--|| reviews : "для отзыва"