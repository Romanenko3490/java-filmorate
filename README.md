# Filmorate Database Schema

## Описание структуры базы данных

### Основные сущности

#### 1. Пользователи (`users`)

| Поле       | Тип         | Ограничения                          | Описание                |
|------------|-------------|--------------------------------------|-------------------------|
| user_id    | INT         | GENERATED BY DEFAULT AS IDENTITY PK  | Уникальный идентификатор|
| email      | VARCHAR(50) | NOT NULL, UNIQUE                     | Электронная почта       |
| login      | VARCHAR(50) | NOT NULL                             | Логин пользователя      |
| name       | VARCHAR(50) |                                      | Имя пользователя        |
| birthday   | DATE        |                                      | Дата рождения           |

#### 2. Фильмы (`films`)

| Поле          | Тип          | Ограничения                          | Описание               |
|---------------|--------------|--------------------------------------|------------------------|
| film_id       | INT          | GENERATED BY DEFAULT AS IDENTITY PK  | Уникальный идентификатор|
| name          | VARCHAR(100) | NOT NULL                             | Название фильма        |
| description   | VARCHAR(200) |                                      | Описание фильма        |
| release_date  | DATE         | NOT NULL                             | Дата выхода            |
| duration      | INT          | NOT NULL, CHECK (duration > 0)       | Продолжительность(мин) |
| mpa_rating_id | INT          | REFERENCES mpa_rating(mpa_id)        | Возрастной рейтинг     |

### Справочные таблицы

#### 3. Жанры (`genre`)

| Поле       | Тип         | Ограничения               | Описание         |
|------------|-------------|---------------------------|------------------|
| genre_id   | INT         | PRIMARY KEY               | ID жанра         |
| name       | VARCHAR(50) | NOT NULL, UNIQUE          | Название жанра   |

#### 4. Возрастные рейтинги (`mpa_rating`)

| Поле         | Тип         | Ограничения               | Описание               |
|--------------|-------------|---------------------------|------------------------|
| mpa_id       | INT         | PRIMARY KEY               | ID рейтинга            |
| mpa_name     | VARCHAR(10) | NOT NULL, UNIQUE          | Код рейтинга (G, PG-13)|
| description  | VARCHAR(200)|                           | Описание рейтинга      |

### Таблицы связей

#### 5. Дружба (`friendship`)

| Поле         | Тип         | Ограничения                              | Описание                |
|--------------|-------------|------------------------------------------|-------------------------|
| user_id      | INT         | PK, FK (users.user_id) ON DELETE CASCADE | ID пользователя         |
| friend_id    | INT         | PK, FK (users.user_id) ON DELETE CASCADE | ID друга                |
| status       | VARCHAR(20) | DEFAULT 'PENDING', CHECK IN ('PENDING','CONFIRMED') | Статус дружбы |
| created_date | TIMESTAMP   | DEFAULT CURRENT_TIMESTAMP                | Дата создания связи     |

#### 6. Связь фильмов и жанров (`film_genre`)

| Поле     | Тип  | Ограничения                              | Описание         |
|----------|------|------------------------------------------|------------------|
| film_id  | INT  | PK, FK (films.film_id) ON DELETE CASCADE | ID фильма        |
| genre_id | INT  | PK, FK (genre.genre_id) ON DELETE CASCADE| ID жанра         |

#### 7. Лайки фильмов (`film_likes`)

| Поле     | Тип  | Ограничения                              | Описание         |
|----------|------|------------------------------------------|------------------|
| film_id  | INT  | PK, FK (films.film_id) ON DELETE CASCADE | ID фильма        |
| user_id  | INT  | PK, FK (users.user_id) ON DELETE CASCADE | ID пользователя  |

## ER-диаграмма базы данных Filmorate

```mermaid
erDiagram
    users ||--o{ friendship : "friends"
    users ||--o{ film_likes : "likes"
    films ||--o{ film_genre : "has"
    films ||--o{ film_likes : "receives"
    films }|--|| mpa_rating : "rated"
    film_genre }|--|| genre : "of"

    users {
        int user_id PK "GENERATED BY DEFAULT AS IDENTITY"
        varchar(50) email "NOT NULL, UNIQUE"
        varchar(50) login "NOT NULL"
        varchar(50) name
        date birthday
    }
    
    films {
        int film_id PK "GENERATED BY DEFAULT AS IDENTITY"
        varchar(100) name "NOT NULL"
        varchar(200) description
        date release_date "NOT NULL"
        int duration "NOT NULL, CHECK > 0"
        int mpa_rating_id FK
    }
    
    genre {
        int genre_id PK
        varchar(50) name "NOT NULL, UNIQUE"
    }
    
    mpa_rating {
        int mpa_id PK
        varchar(10) mpa_name "NOT NULL, UNIQUE"
        varchar(200) description
    }
    
    friendship {
        int user_id PK,FK "ON DELETE CASCADE"
        int friend_id PK,FK "ON DELETE CASCADE"
        varchar(20) status "DEFAULT 'PENDING'"
        timestamp created_date "DEFAULT CURRENT_TIMESTAMP"
        CHECK: "user_id != friend_id"
    }
    
    film_genre {
        int film_id PK,FK "ON DELETE CASCADE"
        int genre_id PK,FK "ON DELETE CASCADE"
    }
    
    film_likes {
        int film_id PK,FK "ON DELETE CASCADE"
        int user_id PK,FK "ON DELETE CASCADE"
    }